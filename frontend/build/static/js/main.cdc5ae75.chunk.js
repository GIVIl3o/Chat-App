(window.webpackJsonpfrontend=window.webpackJsonpfrontend||[]).push([[0],{104:function(e,t){},129:function(e,t,a){},130:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),r=a(26),o=a.n(r),c=a(21),i=a(64),u=a.n(i),p="SET_AUTHENTICATED",l="OPEN_SOCKET",m="CLOSE_SOCKET",h="SET_SHOW_ACCOUNT",g="SET_SHOW_PASSWORD",d="SET_USER_MESSAGE",f="SET_ACTIVE_USER",w="SET_USERS",v="NEW_MISSED_MESSAGE",j="ADD_NEW_USER",b="SET_USER_ONLINE",O="SET_USER_OFFLINE",y={jwt:"",username:""};var E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case p:return{loading:e.loading,jwt:t.jwt,username:t.username};default:return e}},k=a(65),S=a.n(k),C={socket:null};var N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C;switch((arguments.length>1?arguments[1]:void 0).type){case l:return{socket:S()("ws://localhost:3001",{query:{jwt:localStorage.getItem("jwt")}})};case m:return e.socket.close(),e;default:return e}},M={showAccount:void 0,showPassword:void 0,messageSuccess:!1,userMessage:""};var P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h:return Object.assign({},e,{showAccount:!e.showAccount});case g:return Object.assign({},e,{showPassword:!e.showPassword});case d:return Object.assign({},e,{messageSuccess:t.success,userMessage:t.message});default:return e}},U=a(14),A=[];var T=function(){var e,t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,s=arguments.length>1?arguments[1]:void 0;switch(s.type){case w:return(e=s.users.map((function(e){return Object.assign({},e,{activeUser:!1,missedMessages:!1})}))).length&&(e[0].activeUser=!0),e;case f:return(e=Object(U.a)(a)).find((function(e){return e.activeUser})).activeUser=!1,(t=e.find((function(e){return e.username===s.activeUser}))).activeUser=!0,t.missedMessages=!1,e;case v:return(t=(e=Object(U.a)(a)).find((function(e){return e.username===s.msg.from}))).missedMessages=!0,e;case j:return[].concat(Object(U.a)(a),[{username:s.username,activeUser:!1,missedMessages:!1,online:!1}]);case b:return(t=(e=Object(U.a)(a)).find((function(e){return e.username===s.username})))&&(t.online=!0),e;case O:return(t=(e=Object(U.a)(a)).find((function(e){return e.username===s.username})))&&(t.online=!1),e;default:return a}},x=Object(c.b)({self:E,socket:N,UI:P,users:T}),D=Object(c.c)(x);try{var I=u()(localStorage.getItem("jwt"));1e3*I.exp>Date.now()&&(D.dispatch({type:p,jwt:localStorage.getItem("jwt"),username:I.username}),D.dispatch({type:l}))}catch(Ce){}var R=D,_=a(2),F=a(38),L=a.n(F),W=a(67),K=a(19),H=a(3),V=a(4),B=a(6),G=a(5),J=a(7),q=a(15),Y=a(28),z=a.n(Y),Q=(a(62),function(e){function t(){var e,a;Object(H.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(B.a)(this,(e=Object(G.a)(t)).call.apply(e,[this].concat(n)))).state={username:"",password:"",errorMessage:""},a.onChange=function(e){a.setState(Object(K.a)({},e.target.name,e.target.value))},a.loginAttempt=function(){var e=Object(W.a)(L.a.mark((function e(t){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),z.a.post("/verifyUser",{username:a.state.username,password:a.state.password}).then((function(e){localStorage.setItem("jwt",e.data.jwt),a.props.dispatch({type:l}),a.props.dispatch({type:p,jwt:e.data.jwt,username:a.state.username}),a.props.history.push("/")})).catch((function(e){var t=e.response.data;a.setState(t),setTimeout((function(){a.setState({errorMessage:""})}),3e3)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a}return Object(J.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return n.a.createElement("div",{className:"authentication"},n.a.createElement("form",null,n.a.createElement("input",{type:"text",name:"username",onChange:this.onChange,placeholder:"username",value:this.state.username,className:"authentication-inputText",autoFocus:!0}),n.a.createElement("input",{type:"password",name:"password",onChange:this.onChange,placeholder:"password",value:this.state.password,className:"authentication-inputText"}),n.a.createElement("input",{type:"submit",onClick:this.loginAttempt,value:"Login",className:"authentication-inputSubmit"}),n.a.createElement(q.a,{to:"/registration",className:"link"},"Sign Up"),n.a.createElement("span",{className:"errors"},this.state.errorMessage)))}}]),t}(n.a.Component)),X=Object(_.b)((function(e){return{loading:e.self.loading}}))(Q),Z=a(18),$=function(e){function t(){var e,a;Object(H.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(B.a)(this,(e=Object(G.a)(t)).call.apply(e,[this].concat(n)))).state={username:"",password:"",passwordRepeat:"",errorMessage:"",image:null},a.onChange=function(e){a.setState(Object(K.a)({},e.target.name,e.target.value))},a.imgChange=function(e){e.target.files[0].type.startsWith("image")?a.setState({image:e.target.files[0]}):(a.setState({errorMessage:"File must be an image"}),setTimeout((function(){a.setState({errorMessage:""})}),3e3))},a.registrationAttempt=function(e){if(e.preventDefault(),a.state.password!==a.state.passwordRepeat)return a.setState({errorMessage:"passwords do not match"}),void setTimeout((function(){a.setState({errorMessage:""})}),3e3);var t=new FormData;t.append("username",a.state.username),t.append("password",a.state.password),t.append("image",a.state.image);z.a.post("/registerUser",t,{headers:{"content-type":"multipart/form-data"}}).then((function(e){localStorage.setItem("jwt",e.data.jwt),a.props.dispatch({type:l}),a.props.dispatch({type:p,jwt:e.data.jwt,username:a.state.username})})).catch((function(e){var t=e.response.data;a.setState(t),setTimeout((function(){a.setState({errorMessage:""})}),3e3)}))},a}return Object(J.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return n.a.createElement("div",{className:"authentication"},n.a.createElement("form",null,n.a.createElement("input",{type:"text",name:"username",onChange:this.onChange,placeholder:"username",value:this.state.username,className:"authentication-inputText",autoFocus:!0}),n.a.createElement("input",{type:"password",name:"password",onChange:this.onChange,placeholder:"password",value:this.state.password,className:"authentication-inputText"}),n.a.createElement("input",{type:"password",name:"passwordRepeat",onChange:this.onChange,placeholder:"repeat password",value:this.state.passwordRepeat,className:"authentication-inputText"}),n.a.createElement("button",{className:"setProfile",type:"button"},n.a.createElement("label",{htmlFor:"image-upload",className:"change-image"},"Profile Picture")),n.a.createElement("input",{type:"file",id:"image-upload",onChange:this.imgChange,value:""})," ",n.a.createElement("input",{type:"submit",onClick:this.registrationAttempt,value:"Registration",className:"authentication-inputSubmit",disabled:null===this.state.image}),n.a.createElement(q.a,{to:"/login",className:"link"},"Sign In"),n.a.createElement("span",{className:"errors"},this.state.errorMessage)))}}]),t}(n.a.Component),ee=Object(_.b)()($),te=function(e){function t(){var e,a;Object(H.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(B.a)(this,(e=Object(G.a)(t)).call.apply(e,[this].concat(n)))).state={disabled:!1},a.updateImage=function(e){if(!e.target.files[0].type.startsWith("image"))return a.props.dispatch({type:d,success:!1,message:"File must be an image"}),void setTimeout((function(){a.props.dispatch({type:d,success:!1,message:""})}),3e3);var t=new FileReader;t.readAsArrayBuffer(e.target.files[0]),t.onload=function(){a.setState({canChange:!0}),a.props.socket.emit("changePicture",{jwt:a.props.jwt,image:t.result},(function(e){e.profileChanged&&a.setState(a.state),a.setState({canChange:!1})}))}},a}return Object(J.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("button",{className:"setProfile",disabled:this.state.canChange},n.a.createElement("label",{htmlFor:"image-upload",className:"change-image"},"Change Picture")),n.a.createElement("input",{type:"file",id:"image-upload",onChange:this.updateImage,value:""}))}}]),t}(n.a.Component),ae=Object(_.b)((function(e){var t=e.self,a=e.socket;return{jwt:t.jwt,socket:a.socket}}))(te),se=function(e){function t(){var e,a;Object(H.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(B.a)(this,(e=Object(G.a)(t)).call.apply(e,[this].concat(n)))).profileChange=function(){a.forceUpdate()},a}return Object(J.a)(t,e),Object(V.a)(t,[{key:"componentDidMount",value:function(){this.props.socket.on("ChangeProfile#".concat(this.props.username),this.profileChange)}},{key:"componentWillUnmount",value:function(){this.props.socket.removeListener("ChangeProfile#".concat(this.props.username),this.profileChange)}},{key:"render",value:function(){return n.a.createElement("img",{src:"/profiles/".concat(this.props.username,"?").concat(Date.now()),alt:"Profile",className:this.props.className})}}]),t}(n.a.Component),ne=Object(_.b)((function(e){return{socket:e.socket.socket}}))(se);function re(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}var oe=function(e){function t(){var e,a;Object(H.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(B.a)(this,(e=Object(G.a)(t)).call.apply(e,[this].concat(n)))).state={currentPassword:"",newPassword:"",newPasswordRepeat:""},a.onChange=function(e){a.setState(Object(K.a)({},e.target.name,e.target.value))},a.submitChange=function(e){if(e.preventDefault(),a.state.newPassword!==a.state.newPasswordRepeat)return a.props.dispatch({type:d,success:!1,message:"Passwords don't match"}),void setTimeout((function(){a.props.dispatch({type:d,success:!1,message:""})}),3e3);a.props.socket.emit("changePassword",{jwt:a.props.jwt,currentPassword:a.state.currentPassword,newPassword:a.state.newPassword},(function(e){a.setState({currentPassword:"",newPassword:"",newPasswordRepeat:""}),a.props.dispatch(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?re(a,!0).forEach((function(t){Object(K.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):re(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({type:d},e)),setTimeout((function(){a.props.dispatch({type:d,success:!1,message:""})}),3e3)}))},a.classNames="animation-settings no-height",a}return Object(J.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){var e=this;return void 0!==this.props.showPassword&&(this.classNames="animation-settings "+(this.props.showPassword?"unfold-settings":"fold-settings")),n.a.createElement("div",{className:"changePassword"},n.a.createElement("button",{className:"account-button",onClick:function(){return e.props.dispatch({type:g})}},"Change Password"),n.a.createElement("div",{className:this.classNames},n.a.createElement("form",null,n.a.createElement("input",{type:"password",className:"change-password",placeholder:"Your Current Password",name:"currentPassword",value:this.state.currentPassword,onChange:this.onChange}),n.a.createElement("input",{type:"password",className:"change-password",placeholder:"New Password",name:"newPassword",value:this.state.newPassword,onChange:this.onChange}),n.a.createElement("input",{type:"password",className:"change-password",placeholder:"Repeat New Password",name:"newPasswordRepeat",value:this.state.newPasswordRepeat,onChange:this.onChange}),n.a.createElement("input",{type:"submit",onClick:this.submitChange,value:"Change Password",className:"account-button smaller-centered"}))))}}]),t}(n.a.Component),ce=Object(_.b)((function(e){var t=e.self,a=e.socket,s=e.UI;return{jwt:t.jwt,socket:a.socket,showPassword:s.showPassword}}))(oe),ie=(a(63),function(e){function t(){var e,a;Object(H.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(B.a)(this,(e=Object(G.a)(t)).call.apply(e,[this].concat(n)))).logout=function(){localStorage.removeItem("jwt"),a.props.dispatch({type:m}),a.props.dispatch({type:p,jwt:"",username:""})},a.classNames="animation-settings no-height",a}return Object(J.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){var e=this;void 0!==this.props.showAccount&&(this.classNames="animation-settings "+(this.props.showAccount?"unfold-settings":"fold-settings"));var t="user-message "+(this.props.messageSuccess?"message-success":"");return n.a.createElement("div",{className:"account"},n.a.createElement("div",{className:"account-settings",onClick:function(){return e.props.dispatch({type:h})}},n.a.createElement(ne,{username:this.props.username,className:"profile-picture"}),n.a.createElement("span",{className:"profile-text"},"Profile")),n.a.createElement("div",{className:this.classNames},n.a.createElement(ce,null),n.a.createElement(ae,null),n.a.createElement("button",{className:"account-button",onClick:this.logout},"Logout"),n.a.createElement("span",{className:t},this.props.userMessage)))}}]),t}(n.a.Component)),ue=Object(_.b)((function(e){var t=e.self,a=e.socket,s=e.UI;return{username:t.username,socket:a.socket,showAccount:s.showAccount,messageSuccess:s.messageSuccess,userMessage:s.userMessage}}))(ie),pe=(a(129),function(e){function t(){var e,a;Object(H.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(B.a)(this,(e=Object(G.a)(t)).call.apply(e,[this].concat(n)))).setActive=function(){a.props.dispatch({type:f,activeUser:a.props.username})},a}return Object(J.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){var e=this.props.username,t=this.props.online?"Online":"Offline",a="user-active "+(this.props.online?"user-online":""),s=(this.props.missedMessages?"missed-messages":"")+(this.props.activeUser?"activeUser":"");return n.a.createElement("div",{className:"user ".concat(s),onClick:this.setActive},n.a.createElement(ne,{username:e,className:"user-avatar"}),n.a.createElement("div",{className:"user-information"},n.a.createElement("span",{className:"user-username"},e),n.a.createElement("span",{className:a},""+t)))}}]),t}(n.a.Component)),le=Object(_.b)()(pe),me=function(e){function t(){var e,a;Object(H.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(B.a)(this,(e=Object(G.a)(t)).call.apply(e,[this].concat(n)))).state={users:[]},a}return Object(J.a)(t,e),Object(V.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.socket.emit("getUsers",{jwt:this.props.jwt},(function(t){e.props.dispatch({type:w,users:t})})),this.props.socket.on("userCreated",(function(t){e.props.dispatch({type:j,username:t.username})})),this.props.socket.on("userConnect",(function(t){e.props.dispatch({type:b,username:t.username})})),this.props.socket.on("userDisconnect",(function(t){e.props.dispatch({type:O,username:t.username})}))}},{key:"render",value:function(){var e=this.props.users.filter((function(e){return e.online})),t=this.props.users.filter((function(e){return!e.online}));return n.a.createElement("div",{className:"online-people"},e.map((function(e){return n.a.createElement(le,{key:e.username,username:e.username,activeUser:e.activeUser,missedMessages:e.missedMessages,online:e.online})})),t.map((function(e){return n.a.createElement(le,{key:e.username,username:e.username,activeUser:e.activeUser,missedMessages:e.missedMessages,online:e.online})})))}}]),t}(n.a.Component),he=Object(_.b)((function(e){var t=e.self,a=e.socket,s=e.users;return{jwt:t.jwt,username:t.username,socket:a.socket,users:s}}))(me),ge=function(e){function t(){var e,a;Object(H.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(B.a)(this,(e=Object(G.a)(t)).call.apply(e,[this].concat(n)))).state={messages:[],viewMore:!0},a.receiveMessage=function(e){var t=a.props.activeUser;t===e.from||t===e.to?a.setState({messages:[].concat(Object(U.a)(a.state.messages),[e])}):a.props.dispatch({type:v,msg:e})},a.getMessages=function(e){a.props.socket.emit("getMessages",{jwt:a.props.jwt,sender:a.props.activeUser,offset:e.length,count:10},(function(t){t.reverse();var s=t.length>=10;a.setState({messages:[].concat(Object(U.a)(t),Object(U.a)(e)),viewMore:s})}))},a.moreMessages=function(){a.getMessages(a.state.messages)},a}return Object(J.a)(t,e),Object(V.a)(t,[{key:"componentDidMount",value:function(){this.getMessages(this.state.messages),this.props.socket.on("receiveMessage",this.receiveMessage)}},{key:"componentWillUnmount",value:function(){this.props.socket.removeListener("receivedMessage",this.receiveMessage)}},{key:"componentDidUpdate",value:function(e){e.activeUser!==this.props.activeUser&&this.getMessages([]),this.chatEnd.scrollIntoView()}},{key:"render",value:function(){var e=this,t=this.state.viewMore?n.a.createElement("span",{className:"more-messages",onClick:this.moreMessages},"View More"):"";return n.a.createElement("div",{className:"registered-messages"},t,this.state.messages.map((function(t){var a=t.from!==e.props.activeUser?"send-message":"received-message";return n.a.createElement("div",{className:"message ".concat(a),key:t.id},n.a.createElement("span",null,t.message))})),n.a.createElement("div",{ref:function(t){return e.chatEnd=t}}))}}]),t}(n.a.Component),de=Object(_.b)((function(e){var t=e.self,a=e.users,s=e.socket,n=a.find((function(e){return e.activeUser}));return n=(n||{username:"alex"}).username,{jwt:t.jwt,socket:s.socket,activeUser:n}}))(ge),fe=a(69),we=function(e){function t(){var e,a;Object(H.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(B.a)(this,(e=Object(G.a)(t)).call.apply(e,[this].concat(n)))).state={toSendMessage:""},a.sendMessage=function(){a.props.socket.emit("onMessage",{jwt:a.props.jwt,to:a.props.activeUser,message:a.state.toSendMessage}),a.setState({toSendMessage:""})},a.onKeyDown=function(e){e.shiftKey||"Enter"!==e.key||(""!==a.state.toSendMessage&&a.sendMessage(),e.preventDefault())},a}return Object(J.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"chat"},n.a.createElement(de,null),n.a.createElement(fe.a,{maxRows:3,onChange:function(t){return e.setState({toSendMessage:t.target.value})},className:"input-message",value:this.state.toSendMessage,onKeyDown:this.onKeyDown,autoFocus:!0}))}}]),t}(n.a.Component),ve=Object(_.b)((function(e){var t=e.self,a=e.users,s=e.socket,n=a.find((function(e){return e.activeUser}));return n=(n||{username:"alex"}).username,{jwt:t.jwt,socket:s.socket,activeUser:n}}))(we),je=function(e){function t(){return Object(H.a)(this,t),Object(B.a)(this,Object(G.a)(t).apply(this,arguments))}return Object(J.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return n.a.createElement("div",{className:"messaging"},n.a.createElement(he,null),n.a.createElement(ve,null))}}]),t}(n.a.Component),be=function(e){function t(){var e,a;Object(H.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(B.a)(this,(e=Object(G.a)(t)).call.apply(e,[this].concat(n)))).jwtExpiredListener=function(){localStorage.removeItem("jwt"),a.props.dispatch({type:m}),a.props.dispatch({type:p,jwt:"",username:""})},a}return Object(J.a)(t,e),Object(V.a)(t,[{key:"componentDidMount",value:function(){this.props.socket.on("jwtExpired",this.jwtExpiredListener)}},{key:"componentWillUnmount",value:function(){this.props.socket.removeListener("jwtExpired",this.jwtExpiredListener)}},{key:"render",value:function(){return n.a.createElement("div",{className:"chat-container"},n.a.createElement(je,null),n.a.createElement(ue,null))}}]),t}(n.a.Component),Oe=Object(_.b)((function(e){return{socket:e.socket.socket}}))(be),ye=a(9),Ee=Object(_.b)((function(e){return{jwt:e.self.jwt}}))((function(e){var t=e.component;return e.jwt?n.a.createElement(Z.b,{exact:!0,path:"/",component:t}):n.a.createElement(Z.b,{exact:!0,path:"/",component:function(){return n.a.createElement(Z.a,{to:"/login"})}})})),ke=Object(_.b)((function(e){return{jwt:e.self.jwt}}))((function(e){var t=e.component,a=e.jwt,s=e.path;return a?n.a.createElement(Z.b,{component:function(){return n.a.createElement(Z.a,{to:"/"})},exact:!0,path:s}):n.a.createElement(Z.b,{component:t,exact:!0,path:s})}));var Se=function(){return n.a.createElement(_.a,{store:R},n.a.createElement(Z.c,{history:Object(ye.a)()},n.a.createElement(ke,{exact:!0,path:"/login",component:X}),n.a.createElement(ke,{exact:!0,path:"/registration",component:ee}),n.a.createElement(Ee,{exact:!0,path:"/",component:Oe})))};o.a.render(n.a.createElement(Se,null),document.getElementById("root"))},62:function(e,t,a){},63:function(e,t,a){},70:function(e,t,a){e.exports=a(130)}},[[70,1,2]]]);
//# sourceMappingURL=main.cdc5ae75.chunk.js.map